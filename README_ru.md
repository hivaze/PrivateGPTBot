## Умный телеграм бот на основе ChatGPT

Асинхронный бот с несколькими персонажами для доступа по вашему OpenAI ключу к API gpt-3.5 и gpt-4 (chatgpt). 
Умеет работать с документами и интернетом, воспринимает картинки с помощью BLIP.

### Адрес бота
t.me/personalized_ai_bot - можете попробовать прямо сейчас если бот находится в глобальном режиме.

### Возможности
- **Полная асинхронность**: За счет aiogram, бот полностью асинхронен и активно использует мультипоточность.
- **Поддержка function-calling**: Работа с любым количеством документов, а также скрапинг вебсайтов.
- **Мультиязычность интерфейса**: Автоматическая подстройка интерфейса под язык пользователя.
- **Адаптивное урезание истории**: Бот способен адаптивно обрабатывать и урезать историю сообщений по размеру контекста модели.
- **Обработка изображений**: Бот может воспринимать и обрабатывать изображения.
- **Кастомизация сообщений**: Бот предоставляет возможность полной кастомизации всех сообщений.
- **Создание персонажа**: Возможность создать уникального персонажа в рамках сессии.
- **Система пакетов токенов**: Возможность контроля потребления токенов с помощью пакетов токенов с различными уровнями и сроком действия.
- **Реляционная база данных**: Использование SQLite/Postgres для хранения и управления данными пользователей.
- **Векторная база данных**: Использование ChromaDB для хранения документов пользователей.
- **Система ролей и управления доступом**: Возможность управления доступом к различным моделям, включая gpt3.5/gpt4.
- **Обработка пересланных сообщений**: Понимание пересланных сообщений от других пользователей или каналов.
- **Учет информации о пользователе**: Учет информации о пользователе, а также текущего времени и даты при формировании ответов.
- **Автоматический выбор модели**: Автоматически переходит на модель с 16k контекстом если контекст выходит за 4k токенов.
- **Сбор обратной связи**: С помошью кнопки в меню, пользователи легко могут связаться с админами.
- **Сессии на основе LRU**: Бот хранит активные данные (сессии) только по последних N пользователях.
- **Регенерация сообщений**: Возможность перегенерировать сообщения с использованием различных моделей.
- **Интегрированная мощь компонентов langchain**: Бот не полагается на агентов оттуда, но использует lanngchain для работы с большим количеством типов документов.
- **Docker-native**: Проект спроектирован для запуска в Docker, но может использоваться и без него.

Используемые фреймворки: `aiogram`, `langchain`, `SQLAlchemy`, `openai`, `transformers` и `torch`. \
Полный список зависимостей в `requirements.txt`.

Все конфиги находятся в `resources/`.

Запуск после установки зависимостей и настройки просто: `python main.py`.

### TODO Roadmap
- ✔️ Адаптивное урезание истории
- ✔️ Добавление возможности воспринимать картинки (BLIP)
- ✔️ Возможность полной кастомизации всех сообщений
- ✔️ Возможность создавать своего персонажа в рамках сессии
- ✔️ Реляционная БД пользователей (SQLite)
- ✔️ Автоматическая мультиязычность интерфейса
- ✔️ Система ролей и доступ к разным моделям (gpt3.5/gpt4)
- ✔️ Понимание пересланных сообщений от других пользователей или каналов
- ✔️ Учет информации о пользователе в промпте и текущего времени и даты
- ✔️ Рефакторинг для добавления langchain и нового функционала
- ✔️ Возможность перегенерировать сообщения с разными моделями
- ✔️ Переработка механизма урезания истории (удаление сообщений целиком)
- ✔️ Поддержка автоматического определения модели под размер контекста
- ✔️ Настройки пользователей в inline keyboard
- ✔️ Полноценная поддержка Docker, ChromaDB и Postgres
- ✔️ Поддержка function-calling (Работа с любым количеством документов, Скрапинг вебсайтов)
- ✔️ Проработка пакетов токенов, ограничения на использование
- ⏳ Система напоминаний / учета интересов пользователя
- ⏳ Непассивное общение (отправка сообщений-тригеров время от времени)
- ⏳ Возможность понимать голосовые сообщения
- ⏳ Возможность генерировать картинки
- ⏳ Возможность отвечать голосовыми сообщениями

### Конфигурация

Основная конфигурация описана в `resources/config.json` \
Персонажи настраиваются в `resources/personalities.json` \
Все сообщения можно поменять в `resources/messages.json`

### Схема базы данных0,

![Database Arch](docs/db_schema.png)